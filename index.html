<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>dodori LAB</title>
<style>
  :root{
    --accent:#a4886d;          /* 버튼/핀/외곽선 색 */
    --bg:#f8f2ed;              /* 페이지 배경 */
    --card:#fff;
    --ink:#6d4f34;             /* 텍스트 색 */
    --line:#a4886d;            /* 입력창 라인 색 */
    --pink-btn:#FEEFF5;        /* 삭제 버튼 색(연) */
    --pink-text:#9D174D;
  }
  *{box-sizing:border-box}
  body{
    margin:0;background:var(--bg);color:var(--ink);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif
  }
  .wrap{max-width:980px;margin:0 auto;padding:28px 16px}

  .overline{font-size:12px;letter-spacing:.02em;color:var(--ink);text-align:center;margin-bottom:4px}
  h1{margin:8px 0 22px;font-size:32px;text-align:center;color:var(--ink)}
  @media (max-width:480px){ h1{font-size:26px} }

  .grid{display:grid;gap:20px}
  @media(min-width:900px){.grid{grid-template-columns:560px 1fr}}

  .card{background:var(--card);border-radius:18px;box-shadow:0 8px 24px rgba(0,0,0,.08);overflow:hidden}
  .pad{padding:24px}                 /* ✅ 여백 살짝 증가 */
  @media (max-width:480px){ .pad{padding:20px} }  /* ✅ 모바일도 약간 증가 */

  /* 휠 */
  .wheel-box{width:min(100%,520px);margin:0 auto;}
  .wheel-wrap{position:relative;width:100%;aspect-ratio:1/1;}
  svg{width:100%;height:100%;display:block}
  #slices,#borders,#labels{transform-box:fill-box;transform-origin:50% 50%}

  /* 상단 핀 */
  .pin{
    position:absolute;left:50%;transform:translateX(-50%);top:-4px;width:0;height:0;
    border-left:14px solid transparent;border-right:14px solid transparent;
    border-top:24px solid var(--accent);
    filter:drop-shadow(0 2px 2px rgba(0,0,0,.25))
  }

  .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;justify-content:center}
  button{border:0;border-radius:12px;padding:12px 18px;font:inherit;cursor:pointer}
  .primary{background:var(--accent);color:#fff}
  .ghost{background:#eef4ff;color:#3B82F6}
  .danger{background:var(--pink-btn);color:var(--pink-text)}

  /* 결과 영역 */
  .result{font-size:20px;margin:16px 0 0;text-align:center;color:var(--ink)}
  .result .label{font-weight:400;margin-right:4px}
  .result .value{font-weight:700}

  .inputs-title{margin:0 0 6px;font-size:18px;color:var(--ink);text-align:center}
  .inputs{display:flex;flex-direction:column;gap:8px;margin-top:10px}
  .input-row{display:flex;gap:8px}
  .input-row input{
    flex:1;border:1px solid var(--line);border-radius:10px;padding:10px 12px;font:inherit;color:var(--ink)
  }

  .spin-transition{transition:transform 4s cubic-bezier(0.2,0.8,0.2,1)}
</style>
</head>
<body>
<div class="wrap">
  <div class="overline">dodori LAB - Connect Anything, Create Everything</div>
  <h1>어떤 재료를 사용해 볼까요?</h1>

  <div class="grid">
    <!-- 왼쪽: 돌림판 -->
    <div class="card pad">
      <div class="wheel-box">
        <div class="wheel-wrap">
          <div class="pin"></div>
          <svg viewBox="-50 -50 100 100" aria-label="랜덤 돌림판">
            <g id="slices"  class="spin-transition"></g>
            <g id="borders" class="spin-transition"></g>
            <g id="labels"  class="spin-transition"></g>
          </svg>
        </div>
      </div>

      <div class="row">
        <button id="spin" class="primary">돌리기</button>
      </div>
      <div id="result" class="result">
        <span class="label">선택된 재료:</span><span class="value">없음</span>
      </div>
    </div>

    <!-- 오른쪽: 입력창 -->
    <div class="card pad">
      <h2 class="inputs-title">수집한 재료를 입력해 주세요.</h2>
      <div class="inputs" id="inputs"></div>
      <div class="row">
        <button id="add" class="ghost">항목 추가</button>
        <button id="clear" class="danger">모두 삭제</button>
      </div>
    </div>
  </div>
</div>

<script>
  const deg2rad = d => d * Math.PI / 180;

  function wheelTone(i){
    const levels = [95, 91, 87, 93, 89];
    const L = levels[i % levels.length];
    return `hsl(28, 45%, ${L}%)`;
  }

  const sectorCentroidR = (R, thetaRad) => {
    const half = thetaRad/2;
    if (half === 0) return R*0.6;
    const r = (2*R*Math.sin(half)) / (3*half);
    return Math.min(R*0.82, Math.max(R*0.38, r));
  };

  let gSlices, gBorders, gLabels, inputsBox, resultEl, btnSpin, btnAdd, btnClear;
  let items = ["병뚜껑","종이","빨대","멸균팩"];
  let isSpinning = false;
  const SPIN_TURNS_DEG = 360 * 10;
  let currentDeg = 0;

  function drawChordAlignedLabelFixed(group, textStr, midDeg, thetaRad, r){
    const PADDING=2.0, FONT_BASE=5.0, FONT_MIN=2.6, AVG_W=0.62;
    const half = thetaRad/2;
    const innerWidth = Math.max(0, 2*r*Math.tan(half) - 2*PADDING);
    const angle = midDeg + 90;

    const g = document.createElementNS('http://www.w3.org/2000/svg','g');
    g.setAttribute('transform', `rotate(${angle})`);
    group.appendChild(g);

    const label = (textStr ?? '').toString().trim() || '항목';
    let fontSize = FONT_BASE;
    const needed = label.length * AVG_W * fontSize;
    if(innerWidth > 0 && needed > innerWidth){
      fontSize = Math.max(FONT_MIN, innerWidth / (label.length*AVG_W));
    }

    const t = document.createElementNS('http://www.w3.org/2000/svg','text');
    t.setAttribute('text-anchor','middle');
    t.setAttribute('dominant-baseline','middle');
    t.setAttribute('font-weight','600');
    t.setAttribute('fill', '#6d4f34');
    t.setAttribute('font-size', fontSize.toFixed(2));
    t.setAttribute('x','0');
    t.setAttribute('y', (-r).toFixed(2));
    t.textContent = label;
    g.appendChild(t);
  }

  function drawWheel(){
    const n = items.length;
    gSlices.innerHTML = '';
    gBorders.innerHTML = '';
    gLabels.innerHTML = '';

    if(n === 0){
      const circle = document.createElementNS('http://www.w3.org/2000/svg','circle');
      circle.setAttribute('r','48');
      circle.setAttribute('fill','#E5E7EB');
      gSlices.appendChild(circle);
      gSlices.style.transform = gBorders.style.transform = gLabels.style.transform = `rotate(0deg)`;
      return;
    }

    const slice = 360/n;
    const theta = deg2rad(slice);

    for(let i=0;i<n;i++){
      const start = i*slice - 90;
      const end   = (i+1)*slice - 90;
      const large = slice > 180 ? 1 : 0;
      const x1=48*Math.cos(deg2rad(start)), y1=48*Math.sin(deg2rad(start));
      const x2=48*Math.cos(deg2rad(end)),   y2=48*Math.sin(deg2rad(end));

      const p=document.createElementNS('http://www.w3.org/2000/svg','path');
      p.setAttribute('d',`M0 0 L ${x1} ${y1} A 48 48 0 ${large} 1 ${x2} ${y2} Z`);
      p.setAttribute('fill', wheelTone(i));
      gSlices.appendChild(p);

      const mid=start+slice/2;
      const rCenter=sectorCentroidR(42,theta);
      const rLabel=Math.max(8,Math.min(44,rCenter));
      drawChordAlignedLabelFixed(gLabels, items[i], mid, theta, rLabel);
    }

    /* ✅ 바깥 원: 절반 두께(0.5) */
    const outline=document.createElementNS('http://www.w3.org/2000/svg','circle');
    outline.setAttribute('r','48'); outline.setAttribute('fill','none');
    outline.setAttribute('stroke','#a4886d'); outline.setAttribute('stroke-width','0.5');
    outline.setAttribute('stroke-linejoin','round');
    gBorders.appendChild(outline);

    /* ✅ 안쪽 경계선: 절반 두께(0.35), 중앙에서 시작 */
    const borderColor='#b9a28b';
    for(let i=0;i<n;i++){
      const ang=deg2rad(i*slice-90);
      const xOuter=47*Math.cos(ang), yOuter=47*Math.sin(ang);
      const line=document.createElementNS('http://www.w3.org/2000/svg','line');
      line.setAttribute('x1','0'); line.setAttribute('y1','0');
      line.setAttribute('x2',xOuter.toFixed(2)); line.setAttribute('y2',yOuter.toFixed(2));
      line.setAttribute('stroke',borderColor);
      line.setAttribute('stroke-width','0.35');
      line.setAttribute('stroke-linecap','round');
      gBorders.appendChild(line);
    }

    gSlices.style.transform=`rotate(${currentDeg}deg)`;
    gBorders.style.transform=`rotate(${currentDeg}deg)`;
    gLabels.style.transform=`rotate(${currentDeg}deg)`;
  }

  function ensureOneRow(){ if(inputsBox.children.length===0) addRow(''); }
  function rowTemplate(value=''){
    const row=document.createElement('div');
    row.className='input-row';
    const input=document.createElement('input');
    input.type='text'; input.placeholder='예 : 휴지심'; input.value=value;
    const del=document.createElement('button');
    del.textContent='삭제'; del.className='danger';
    row.appendChild(input); row.appendChild(del);
    input.addEventListener('input', syncFromInputs);
    input.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); addRow(); }});
    del.addEventListener('click', ()=>{ row.remove(); ensureOneRow(); syncFromInputs(); });
    return row;
  }
  function renderInputs(){ inputsBox.innerHTML=''; (items.length?items:['']).forEach(v=>inputsBox.appendChild(rowTemplate(v))); }
  function collectItems(){ return Array.from(inputsBox.querySelectorAll('input')).map(i=>i.value.trim()).filter(Boolean); }
  function syncFromInputs(){
    items=collectItems(); drawWheel();
    resultEl.innerHTML='<span class="label">선택된 재료:</span><span class="value">없음</span>';
  }
  function addRow(value=''){ inputsBox.appendChild(rowTemplate(value)); inputsBox.lastChild.querySelector('input').focus(); }

  function spinOnce(){
    if(isSpinning) return;
    if(!items.length){ alert('항목을 1개 이상 입력해 주세요.'); return; }
    isSpinning=true; btnSpin.disabled=true;
    const n=items.length, slice=360/n;
    const targetIndex=Math.floor(Math.random()*n);
    const mid=targetIndex*slice+slice/2;
    const alignToTop=360-mid;
    const need=(alignToTop-(currentDeg%360)+360)%360;
    currentDeg+=SPIN_TURNS_DEG+need;
    const pickedText=items[targetIndex];
    gSlices.style.transform=`rotate(${currentDeg}deg)`;
    gBorders.style.transform=`rotate(${currentDeg}deg)`;
    gLabels.style.transform=`rotate(${currentDeg}deg)`;
    const onEnd=()=>{
      gSlices.removeEventListener('transitionend',onEnd);
      isSpinning=false; btnSpin.disabled=false;
      resultEl.innerHTML=`<span class="label">선택된 재료:</span><span class="value">${pickedText}</span>`;
    };
    gSlices.addEventListener('transitionend',onEnd,{once:true});
  }

  window.addEventListener('DOMContentLoaded',()=>{
    gSlices=document.getElementById('slices');
    gBorders=document.getElementById('borders');
    gLabels=document.getElementById('labels');
    inputsBox=document.getElementById('inputs');
    resultEl=document.getElementById('result');
    btnSpin=document.getElementById('spin');
    btnAdd=document.getElementById('add');
    btnClear=document.getElementById('clear');
    btnAdd.addEventListener('click',()=> addRow());
    btnClear.addEventListener('click',()=>{
      items=[]; inputsBox.innerHTML=''; addRow('');
      drawWheel();
      resultEl.innerHTML='<span class="label">선택된 재료:</span><span class="value">없음</span>';
    });
    btnSpin.addEventListener('click', spinOnce);
    renderInputs(); drawWheel();
  });
</script>
</body>
</html>
